if("undefined"==typeof BRICKLINK||!BRICKLINK)var BRICKLINK={};BRICKLINK.apps=BRICKLINK.apps||{},function(){function addEvent(e,t,n,i){i=i||e;var r;e.addEventListener?(r=function(e){n.call(i,e)},e.addEventListener(t,r,!1)):e.attachEvent&&(r=function(){var e=window.event;e.target=e.target||e.srcElement,e.preventDefault=function(){window.event.returnValue=!1},n.call(i,e)},e.attachEvent("on"+t,r)),eventCache.push([e,t,n,r])}function removeEvent(e,t,n){var i,r,a;for(a=0;a<eventCache.length;a++)r=eventCache[a],r[0]==e&&r[1]==t&&r[2]==n&&(i=r[3],i&&(e.removeEventListener?e.removeEventListener(t,i,!1):e.detachEvent&&e.detachEvent("on"+t,i)))}function getParent(e){do e=e.parentNode;while(e&&1!=e.nodeType);return e}function getPreviousSibling(e){do e=e.previousSibling;while(e&&1!=e.nodeType);return e}function checkEmptyImage(e){return e.width>1||e.height>1}var defaultConfig={trigger:null,callbackFunction:null,appKey:null};BRICKLINK.apps.flow=function(e){var t=this;return t.UI={},t._init(e),{setTrigger:function(e){t._setTrigger(e)},startFlow:function(e,n){var i=t._render();if(i&&"undefined"!=typeof n&&null!=n){var r=document.createElement("form"),a=document.createElement("input");a.type="hidden",a.name="strData",a.value=JSON.stringify(n),a.id="_idFormInputStrData",r.appendChild(a);var o=document.createElement("input");o.type="hidden",o.name="strAppKey",o.value=t.appKey,o.id="_idFormInputStrAppKey",r.appendChild(o),r.target="BLGFrame",r.method="POST",r.action=e,document.body.appendChild(r),r.submit()}else i||alert("Please allow popups from this site or turn off the popup blocker in your browser settings.")},closeFlow:function(){t._destroy()},isOpen:function(){return t.isOpen},getCallbackFunction:function(){return t.callbackFunction}}},BRICKLINK.apps.flow.prototype={name:"BLGFrame",isOpen:!1,_init:function(e){if(e)for(var t in defaultConfig)"undefined"!=typeof e[t]?this[t]=e[t]:this[t]=defaultConfig[t];this.trigger&&this._setTrigger(this.trigger),this._addCSS()},_render:function(){var ua=navigator.userAgent,win,pollingInterval=0,winOpened=!1;if(ua.match(/iPhone|iPod|Android|Blackberry.*WebKit/i))win=window.open("",this.name),winOpened=!0;else{var width=400,height=540,left,top;window.outerWidth?(left=Math.round((window.outerWidth-width)/2)+window.screenX,top=Math.round((window.outerHeight-height)/2)+window.screenY):window.screen.width&&(left=Math.round((window.screen.width-width)/2),top=Math.round((window.screen.height-height)/2)),win=window.open("",this.name,"top="+top+", left="+left+", width="+width+", height="+height+", location=0, status=0, toolbar=0, menubar=0, resizable=0, scrollbars=1"),winOpened=!0,window.focus&&win.focus()}return winOpened?(pollingInterval=setInterval(function(){if(win&&win.closed&&(clearInterval(pollingInterval),"undefined"!=typeof bl_handler&&null!=bl_handler)){var callbackFunction=bl_handler.getCallbackFunction;if("undefined"!=typeof callbackFunction&&null!=callbackFunction){var runCallbackFunction=eval(callbackFunction());runCallbackFunction()}}},100),win):void 0},_addCSS:function(){var e="",t=document.createElement("style");e+="#"+this.name+" { position:absolute; top:0; left:0; }",e+="#"+this.name+" .panel { z-index:9999; position:relative; }",e+="#"+this.name+" .panel iframe { width:385px; height:550px; border:0; }",e+="#"+this.name+" .mask { z-index:9998; position:absolute; top:0; left:0; background-color:#000; opacity:0.2; filter:alpha(opacity=20); }",e+=".nameOnButton { display: inline-block; text-align: center; }",e+=".nameOnButton img { border:none; }",t.type="text/css",t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e)),document.getElementsByTagName("head")[0].appendChild(t)},_setTrigger:function(e){if(e.constructor.toString().indexOf("Array")>-1)for(var t=0;t<e.length;t++)this._setTrigger(e[t]);else e="string"==typeof e?document.getElementById(e):e,e&&e.form?e.form.target=this.name:e&&"a"==e.tagName.toLowerCase()&&(e.target=this.name),addEvent(e,"click",this._triggerClickEvent,this)},_destroy:function(e){this.isOpen&&this.UI.wrapper.parentNode&&this.UI.wrapper.parentNode.removeChild(this.UI.wrapper),this.interval&&clearInterval(this.interval),removeEvent(window,"unload",this._destroy),removeEvent(window,"message",this._windowMessageEvent),this.isOpen=!1}};var eventCache=[]}();